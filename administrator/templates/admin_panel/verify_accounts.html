{% extends 'admin_login/layout.html' %}
{% load sort_tags %}


{% block navbar %}
    {% include "admin_panel/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="container2 p-6">
    <div class="container mt-4">
        {% if user_role_id == 2 or user_role_id == 3 %}
        <h2 class="text-xl font-bold mb-4">Farmer Accounts{{ account.account_id }}</h2>

        <form method="get" class="mb-3">
            <div class="row g-2 align-items-end">
                <div class="col-md-6">
                    <label for="status" class="form-label mb-0">Filter by Status:</label>
                    <select name="status" id="status" class="form-select form-select-sm" onchange="this.form.submit()">
                        <option value="">All</option>
                        {% for status in status_choices %}
                            <option value="{{ status.pk }}" {% if current_status == status.pk|stringformat:"s" %}selected{% endif %}>{{ status.acc_status }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="municipality" class="form-label mb-0">Filter by Municipality:</label>
                    <select name="municipality" id="municipality" class="form-select form-select-sm" onchange="this.form.submit()">
                        <option value="">All</option>
                        {% for municipality in municipalities %}
                            <option value="{{ municipality.municipality }}" {% if current_municipality == municipality.municipality %}selected{% endif %}>
                                {{ municipality.municipality }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </form>
        {% if accounts %}
        <table class="table table-bordered table-hover">
            <thead class="table-success">
                <tr>
                    <th>{% sort_header "date" "Date Registered" current_sort current_order current_status %}</th>
                    <th>{% sort_header "name" "Full Name" current_sort current_order current_status %}</th>
                    <th>Email</th>
                    <th>Contact Number</th>
                    <th>Municipality</th>
                    <th>Status</th>
                    {% comment %} <th>Barangay</th>
                    <th>Municipality</th>
                    <th>Account Type</th>
                    <th>Registered Date</th> {% endcomment %}
                    <th>Verified By</th>
                    <th> Action </th>
                    <th> Update </th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                <tr>
                    <td>{{ account.account_register_date}}</td>
                    <td>{{ account.userinfo_id.lastname }}, {{ account.userinfo_id.firstname }} {{ account.userinfo_id.middlename|slice:":1" }}.</td>
                    <td>{{ account.userinfo_id.user_email }}</td>
                    <td>{{ account.userinfo_id.contact_number }}</td>
                    <td>{{ account.userinfo_id.municipality_id.municipality }}</td>
                    {% comment %} SHOULD MAKE A CONDITION WHERE THE SHOWN FARMER ACCOUNTS ARE ONLY MATCHING WITH THEIR ASSIGNED MUNICIPALITY {% endcomment %}

                    <td>{{ account.acc_status_id.acc_status }}</td>
                    <td>{{ account.account_verified_by_id.userinfo_id.lastname }}</td>
                    <td>
                        <form method="POST" action="{% url 'administrator:update_account_status' account.account_id %}">
                            {% csrf_token %}
                                <select name="new_status" class="form-select form-select-sm">
                                    {% for status in status_choices %}
                                        <option value="{{ status.pk }}" {% if account.acc_status_id.pk == status.pk %}selected{% endif %}>
                                            {{ status.acc_status }}
                                        </option>
                                    {% endfor %}
                                </select>
                        </form>

                    </td>
                    <td>
                                                    <button type="submit" class="btn btn-primary btn-sm mt-1">Update</button>

                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No accounts found.</p>
    {% endif %}
    {%else%}
            <p>You do not have permission to view this page.</p>
    {% endif%}
    </div>
</div>
{% endblock %}
