{% extends 'admin_login/layout.html' %}
{% load static %}

{% block title %}
Fruit Cast | {% block page_title %}{% endblock %}
{% endblock title %}

{% block navbar %}
    {% include "admin_panel/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm rounded-4 p-4 mb-4">
        {% if user_role_id == 2 and user.is_superuser %}
        {% comment %} restricting view to non admins {% endcomment %}
        <h2 class="text-center mb-4">Assign Account Role</h2>

        <form method="POST" action="{% url 'administrator:assign_account' %}">
          {% if form.errors %}
            <div class="alert alert-danger">
              <strong>Error!</strong> Please correct the errors below.
            </div>
            {% endif %}
            {% csrf_token %}
            {{ form.non_field_errors }}

            <div class="mb-3">
                <label for="{{ form.email.id_for_label }}">Email</label>
                {{ form.email }}
                {{ form.email.errors }}
            </div>

            <div class="mb-3">
                <label for="{{ form.first_name.id_for_label }}">First Name</label>
                {{ form.first_name }}
                {{ form.first_name.errors }}
            </div>

            <div class="mb-3">
                <label for="{{ form.middle_name.id_for_label }}">Middle Name</label>
                {{ form.middle_name }}
                {{ form.middle_name.errors }}
            </div>

            <div class="mb-3">
                <label for="{{ form.last_name.id_for_label }}">Last Name</label>
                {{ form.last_name }}
                {{ form.last_name.errors }}
            </div>

            <div class="mb-3">
                <label for="{{ form.sex.id_for_label }}">Sex</label>
                <div>
                    {% for radio in form.sex %}
                    <div class="form-check form-check-inline">
                        {{ radio.tag }}
                        <label class="form-check-label" for="{{ radio.id_for_label }}">{{ radio.choice_label }}</label>
                    </div>
                    {% endfor %}
                </div>
                {{ form.sex.errors }}
                </div>

            <div class="mb-3">
                <label for="{{ form.account_type.id_for_label }}">Account Type</label>
                {{ form.account_type }}
                {{ form.account_type.errors }}
            </div>

            <div class="mb-3">
                <label for="{{ form.municipality.id_for_label }}">Municipality (Only for Agriculturists)</label>
                <div id="municipality-wrapper">
                    {{ form.municipality }}
                </div>
                {{ form.municipality.errors }}
            </div>
            {% if messages %}
            {% for message in messages %}
              <div class="alert 
                {% if message.tags %} alert-{{ message.tags }} {% endif %} text-danger small mt-2">
                {{ message }}
              </div>
            {% endfor %}
          {% endif %}

            <div class="text-center">
                <button type="submit" class="btn btn-success">Assign Account</button>
            </div>
        </form>
        
        {%else%}
                <p>You do not have permission to view this page. </p>
        {% endif%}
      </div>
    </div>
  </div>
</div>

<script>
  const accountTypeSelect = document.getElementById("id_account_type");
  const municipalitySelect = document.getElementById("municipality-select");

  function updateMunicipalityField() {
    const overallOption = [...municipalitySelect.options].find(opt => opt.value === "14");

    if (accountTypeSelect.value === "Agriculturist") {
      municipalitySelect.disabled = false;
      municipalitySelect.classList.remove("visually-locked");
      if (overallOption) {
        overallOption.hidden = true;
        overallOption.disabled = true;
        overallOption.selected = false;
      }
    } else if (accountTypeSelect.value === "Administrator") {
      //municipalitySelect.disabled = true;
      municipalitySelect.classList.add("visually-locked");
      if (overallOption) {
        overallOption.hidden = false;
        overallOption.disabled = false;
        overallOption.selected = true;
      }
    }
  }

  accountTypeSelect.addEventListener("change", updateMunicipalityField);
  updateMunicipalityField(); // Initialize on page load
</script>




{% endblock %}