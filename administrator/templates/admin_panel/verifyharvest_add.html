{% extends "admin_login/layout.html" %}

{% block title %}
Add Verified Harvest Record
{% endblock title %}

{% block navbar %}
    {% include "admin_panel/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm rounded-4 p-4 mb-4">
                <h2>Add Verified Harvest Record</h2>
                <form method="post">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="id_harvest_date" class="form-label">Harvest Date</label>
                        {{ form.harvest_date }}
                    </div>
                    <div class="mb-3">
                        <label for="id_commodity_id" class="form-label">Commodity</label>
                        {{ form.commodity_id }}
                    </div>
                    <div class="mb-3">
                        <label for="id_total_weight_kg" class="form-label">Total Weight (kg)</label>
                        {{ form.total_weight_kg }}
                    </div>
                    <div class="mb-3">
                        <label for="id_weight_per_unit_kg" class="form-label">Weight per Unit (kg)</label>
                        {{ form.weight_per_unit_kg }}
                    </div>
                    <div class="mb-3">
                        <label for="id_municipality" class="form-label">Municipality</label>
                        <select id="id_municipality" name="municipality" class="form-select">
                            <option value="">Select Municipality</option>
                            {% for m in municipalities %}
                                <option value="{{ m.pk }}">{{ m.municipality }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_barangay" class="form-label">Barangay</label>
                        <select id="id_barangay" name="barangay" class="form-select">
                            <option value="">Select Barangay</option>
                            <!-- Barangays will be dynamically loaded -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_remarks" class="form-label">Remarks</label>
                        {{ form.remarks }}
                    </div>
                    <button type="submit" class="btn btn-success">Save</button>
                    <a href="{% url 'administrator:admin_verifyharvestrec' %}" class="btn btn-secondary">Back to List</a>
                </form>
                <hr>
                <p>or upload a CSV file of harvest records:</p>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <h4>Upload a CSV file with the following format:</h4>
                    <p>harvest_date,commodity,municipality,barangay,total_weight_kg,weight_per_unit_kg,remarks</p>
                    <p>2025-08-01,Mango,Balanga,San Jose,100,1.2,Good harvest</p>
                    <input type="file" name="csv_file" accept=".csv" required>
                    <button type="submit" class="btn btn-success">Upload CSV</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Dynamic Barangay Dropdown
    document.getElementById('id_municipality').addEventListener('change', function() {
        var municipalityId = this.value;
        var barangaySelect = document.getElementById('id_barangay');
        barangaySelect.innerHTML = '<option value="">Loading...</option>';
        fetch('/get_barangays/' + municipalityId + '/')
            .then(response => response.json())
            .then(data => {
                barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
                data.forEach(function(barangay) {
                    barangaySelect.innerHTML += '<option value="' + barangay.id + '">' + barangay.barangay + '</option>';
                });
            });
    });
</script>
{% endblock content %}