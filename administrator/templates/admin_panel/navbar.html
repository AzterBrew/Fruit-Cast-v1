{%load static%}

<header id="header" class="d-block navbar navbar-expand-lg shadow-sm fixed-top bg-green-fc">
    <div class="container-fluid ">
        <!-- Sidebar Toggle and Logo -->
        <div class="d-flex align-items-center">
            <a class="navbar-brand d-flex align-items-center text-white" href="{% url 'administrator:dashboard' %}">
                <img src="{% static 'images/logo/3.png' %}" alt="Fruit Cast Logo" style="max-height: 40px;" class="me-2">
                <span class="fw-bold">Fruit Cast</span>
            </a>
        </div>
        <!-- User Navigation -->
        <nav class="ms-auto bg-green-fc" aria-label="User">
            <ul class="navbar-nav d-flex flex-row align-items-center">

                <!-- User Dropdown -->
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link text-light d-flex align-items-center" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle fs-5 me-2"></i>
                        <span class="d-none d-md-inline">
                            Hi, 
                            {% if user_firstname %}
                                {{ user_firstname }}
                            {% else %}
                                {% if user_role_id == 1 %}
                                    Farmer
                                {% elif user_role_id == 2 %}
                                    Administrator
                                {% elif user_role_id == 3 %}
                                    Agriculturist
                                {% else %}
                                    User
                                {% endif %}
                            {% endif %}!
                        </span>
                        <i class="bi bi-chevron-down ms-1"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end mobile-dropdown">
                        <li><a class="dropdown-item" href="{% url 'base:account_info_panel' %}">
                            <i class="bi bi-person me-2"></i>My Account
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'base:home' %}">
                            <i class="bi bi-clock me-2"></i>Return to Public Site
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        
                        {% if user_role_id == 3 or user_role_id == 2 %}
                            <li><a class="dropdown-item" href="{% url 'administrator:admin_dashboard' %}">
                                <i class="bi bi-shield-check me-2"></i>Admin Panel
                            </a></li>
                        {% endif %}
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form action="{% url 'base:logout' %}" method="post" class="d-inline w-100">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item text-danger">
                                    <i class="bi bi-box-arrow-right me-2"></i>Log out
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
        
    <!-- Main Navigation - Always visible, no collapse -->
    <nav class="ps-3 d-block bg-green-fc border-top border-light border-opacity-25" aria-label="Site">
        <ul class="navbar-nav d-flex flex-row flex-wrap">
          {% if user_role_id == 2 %}
            <li class="nav-item mx-md-1 dropdown">
                <a href="#" class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-graph-up me-1"></i>
                    <span>Fruit and Farmers</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-start mobile-dropdown">
                    <li><a class="dropdown-item" href="{% url 'administrator:admin_verifyplantrec' %}">
                        <i class="bi bi-calendar-month me-2"></i>Verify Plant Records
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'administrator:admin_verifyharvestrec' %}">
                        <i class="bi bi-box-seam me-2"></i>Verify Harvest Records
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'administrator:admin_commodity_list' %}">
                        <i class="bi bi-box-seam me-2"></i>Commodity List
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'administrator:verify_accounts' %}">
                        <i class="bi bi-box-seam me-2"></i>Farmer Accounts
                    </a></li>
                </ul>
            </li>
            <li class="nav-item mx-md-1 dropdown">
                <a href="{% url 'base:newrecord' %}" class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-plus-circle me-1"></i>
                    <span>Admin Functions</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-sm-start mobile-dropdown">
                    <li><a class="dropdown-item" href="{% url 'administrator:show_allaccounts' %}">
                        <i class="bi bi-plus-circle me-1"></i>Adminstrators
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'administrator:show_allaccounts' %}">
                        <i class="bi bi-plus-circle me-1"></i>Agriculturists TENTATIVE
                    </a></li>
                    
                    {% if user.is_superuser and user_role_id == 2 %}
                      <li><a class="dropdown-item" href="{% url 'administrator:assign_account' %}">
                        <i class="bi bi-plus-circle me-1"></i>Manage Privilege
                      </a></li>
                    {% endif%}
                </ul>
            </li>
          {% elif user_role_id == 3 %}
            <li class="nav-item mx-md-1 dropdown">
                <a href="#" class="nav-link dropdown-toggle text-light" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-graph-up me-1"></i>
                    <span>Verify Records</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-start mobile-dropdown">
                    <li><a class="dropdown-item" href="{% url 'administrator:admin_verifyplantrec' %}">
                        <i class="bi bi-calendar-month me-2"></i>Plant Records
                    </a></li>
                    <li><a class="dropdown-item" href="{% url 'administrator:admin_verifyharvestrec' %}">
                        <i class="bi bi-box-seam me-2"></i>Harvest Records
                    </a></li>
                </ul>
            </li>
            <li class="nav-item mx-md-1 dropdown">
              <a class="dropdown-item" href="{% url 'administrator:admin_commodity_list' %}">
                <i class="bi bi-calendar-month me-2"></i>Commodities
              </a>
            </li>
            <li class="nav-item mx-md-1 dropdown">
              <a class="dropdown-item" href="{% url 'administrator:verify_accounts' %}">
                <i class="bi bi-calendar-month me-2"></i>Farmers
              </a>
            </li>
              
          {% endif %}
        </ul>
    </nav>
</header>


<script>
document.addEventListener('DOMContentLoaded', function() {

    // Prevent dropdown menu from closing when clicking inside (optional)
    document.querySelectorAll('.dropdown-menu').forEach(function(dropdown) {
        dropdown.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    });

    // Custom dropdown positioning for mobile
    document.querySelectorAll('.dropdown-toggle').forEach(function(toggle) {
        toggle.addEventListener('shown.bs.dropdown', function() {
            var dropdown = this.nextElementSibling;
            if (dropdown && window.innerWidth <= 768) {
                // Additional mobile-specific positioning if needed
                dropdown.style.transform = 'none';
            }
        });
    });
});
</script>

<style>
/* Custom navbar styles */
#header {
    transition: all 0.3s ease;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

/* Prevent navbar expansion on mobile */
.navbar-nav {
    flex-direction: row !important;
}

.navbar-collapse {
    display: block !important;
}

/* Mobile dropdown improvements */
@media (max-width: 768px) {
    /* Ensure dropdowns are positioned absolutely and don't affect navbar height */
    .mobile-dropdown {
        position: absolute !important;
        transform: none !important;
        border: none;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3) !important;
        border-radius: 0.5rem;
        max-width: 280px;
        min-width: 200px;
        z-index: 1050;
        margin-top: 0.5rem;
    }
    
    /* Make nav text smaller on mobile */
    .nav-link span {
        font-size: 0.9rem;
    }
    
    /* Show icons on mobile for better UX */
    .d-md-none {
        display: inline !important;
    }
    
    /* Adjust navbar padding on mobile */
    .navbar .container-fluid {
        padding-left: 1rem;
        padding-right: 1rem;
    }
    
    /* Main navigation wrapping */
    .navbar-nav.flex-wrap {
        flex-wrap: wrap;
    }
    
    /* User dropdown positioning */
    .dropdown-menu-end {
        right: 0 !important;
        left: auto !important;
    }
    
    .dropdown-menu-start {
        left: 0 !important;
        right: auto !important;
    }
}

/* Notification badge pulse animation */
.nav-link .badge {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Dropdown menu improvements */
.dropdown-menu {
    border: none;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
    border-radius: 0.5rem;
    z-index: 1050;
}

.dropdown-item {
    transition: all 0.2s ease;
    padding: 0.75rem 1rem;
}

.dropdown-item:hover {
    background-color: rgba(0,123,255,0.1);
    transform: translateX(5px);
}

/* Notification styles */
.notif-link:hover {
    text-decoration: none !important;
}

.list-group-item.border-start {
    background-color: rgba(0,123,255,0.02);
}

/* Logo hover effect */
.navbar-brand:hover img {
    transform: rotate(5deg) scale(1.05);
    transition: transform 0.3s ease;
}

/* Ensure main navigation is always visible */
.navbar .container-fluid + nav {
    border-top: 1px solid rgba(255,255,255,0.1);
}

/* Fix for very small screens */
@media (max-width: 480px) {
    .navbar-brand span {
        font-size: 1rem;
    }
    
    .mobile-dropdown {
        max-width: 250px;
        min-width: 180px;
    }
    
    .nav-link {
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
    }
}
</style>