{% extends 'admin_login/layout.html' %}
{% load static %}

{% block title %}
Fruit Cast | Farmer Profile & Transaction History
{% endblock title %}

{% block content %}
<div class="main-user">
    <div class="monitor-user-content justify-content-center">
        <div class="card shadow-sm rounded-4 p-4 mb-3">
            
            <!-- Header Section -->
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3">
                <div class="flex-grow-1">
                    <h2 class="text-success fw-bold mb-1">
                        <i class="bi bi-person-lines-fill me-2"></i>Farmer Profile & Transaction History
                    </h2>
                    <p class="text-muted mb-0">
                        Farmer: <strong>{{ farmer_name }}</strong>
                    </p>
                </div>
                <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center w-lg-auto gap-2">
                    {% if is_agriculturist %}
                        <span class="badge bg-info ms-auto">Viewing: {{ assigned_municipality }} transactions only</span>
                    {% endif %}
                    {% if transactions_paginator %}
                        <span class="badge bg-success ms-auto">{{ transactions_paginator.count }} transaction{{ transactions_paginator.count|pluralize }}</span>
                    {% else %}
                        <span class="badge bg-success ms-auto">{{ transactions|length }} transaction{{ transactions|length|pluralize }}</span>
                    {% endif %}
                    <a href="{% url 'administrator:verify_accounts' %}" class="btn btn-outline-success btn-sm w-sm-auto ms-auto">
                        <i class="bi bi-arrow-left me-2"></i>Back to Verification
                    </a>
                </div>
            </div>
    
    <!-- Personal Information Section -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0 text-success">
                <i class="bi bi-person-lines-fill me-2"></i>Farmer Personal Information
            </h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                {% if user_role_id == 2 %}
                    <!-- Administrator - Full info -->
                    <div class="col-md-6">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-person me-2"></i>Basic Information
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Full Name:</span>
                                <span class="text-sm-end">{{ farmer_info.firstname }} {{ farmer_info.middlename }} {{ farmer_info.lastname }} {{ farmer_info.nameextension }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Sex:</span>
                                <span class="text-sm-end">{{ farmer_info.sex }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Age:</span>
                                <span class="text-sm-end">{{ farmer_age }} years old</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Birth Date:</span>
                                <span class="text-sm-end">{{ farmer_info.birthdate|date:"M d, Y" }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Civil Status:</span>
                                <span class="text-sm-end">{{ farmer_info.civil_status }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-telephone me-2"></i>Contact & Address
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Contact Number:</span>
                                <span class="text-sm-end">{{ farmer_info.contact_number }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Email:</span>
                                <span class="text-sm-end">{{ farmer_info.user_email }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Municipality:</span>
                                <span class="text-sm-end">{{ farmer_info.municipality_id.municipality }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Barangay:</span>
                                <span class="text-sm-end">{{ farmer_info.barangay_id.barangay }}</span>
                            </li>
                            <li class="list-group-item">
                                <span class="fw-medium d-block">Address Details:</span>
                                <div class="mt-1">{{ farmer_info.address_details }}</div>
                            </li>
                        </ul>
                        
                        <h6 class="text-success mb-3 mt-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>Emergency Contact
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Emergency Person:</span>
                                <span class="text-sm-end">{{ farmer_info.emergency_contact_person }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Emergency Number:</span>
                                <span class="text-sm-end">{{ farmer_info.emergency_contact_number }}</span>
                            </li>
                        </ul>
                    </div>
                {% elif user_role_id == 3 %}
                    <!-- Agriculturist - Limited info -->
                    <div class="col-md-6">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-person me-2"></i>Basic Information
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Full Name:</span>
                                <span class="text-sm-end">{{ farmer_info.firstname }} {{ farmer_info.middlename }} {{ farmer_info.lastname }} {{ farmer_info.nameextension }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Sex:</span>
                                <span class="text-sm-end">{{ farmer_info.sex }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Age:</span>
                                <span class="text-sm-end">{{ farmer_age }} years old</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="fw-medium">Birth Date:</span>
                                <span>{{ farmer_info.birthdate|date:"M d, Y" }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span class="fw-medium">Civil Status:</span>
                                <span>{{ farmer_info.civil_status }}</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-telephone me-2"></i>Contact & Address
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Contact Number:</span>
                                <span class="text-sm-end">{{ farmer_info.contact_number }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Email:</span>
                                <span class="text-sm-end">{{ farmer_info.user_email }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Municipality:</span>
                                <span class="text-sm-end">{{ farmer_info.municipality_id.municipality }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Barangay:</span>
                                <span class="text-sm-end">{{ farmer_info.barangay_id.barangay }}</span>
                            </li>
                            <li class="list-group-item">
                                <span class="fw-medium d-block">Address Details:</span>
                                <div class="mt-1">{{ farmer_info.address_details }}</div>
                            </li>
                        </ul>
                        
                        <h6 class="text-success mb-3 mt-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>Emergency Contact
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Emergency Person:</span>
                                <span class="text-sm-end">{{ farmer_info.emergency_contact_person }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Emergency Number:</span>
                                <span class="text-sm-end">{{ farmer_info.emergency_contact_number }}</span>
                            </li>
                        </ul>
                    </div>
                {% elif user_role_id == 3 %}
                    <!-- Agriculturist - Limited info -->
                    <div class="col-md-6">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-person me-2"></i>Basic Information
                        </h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Full Name:</span>
                                <span class="text-sm-end">{{ farmer_info.firstname }} {{ farmer_info.middlename }} {{ farmer_info.lastname }} {{ farmer_info.nameextension }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Sex:</span>
                                <span class="text-sm-end">{{ farmer_info.sex }}</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between flex-column flex-sm-row">
                                <span class="fw-medium">Age:</span>
                                <span class="text-sm-end">{{ farmer_age }} years old</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex justify-content-center align-items-center h-100">
                            <div class="text-center text-muted">
                                <i class="bi bi-shield-lock display-4"></i>
                                <p class="mt-2 mb-0">Additional information<br>restricted for Agriculturists</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            
            <!-- Farm Lands Section (Collapsible) -->
            {% if farm_lands %}
                <hr>
                <div class="mt-3">
                    <h6 class="text-success mb-3">
                        <i class="bi bi-geo-alt me-2"></i>Registered Farm Lands
                        <span class="badge bg-success ms-2">{{ farm_lands|length }}</span>
                    </h6>
                    <div class="accordion" id="farmLandsAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="farmLandsHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#farmLandsCollapse" aria-expanded="false" 
                                        aria-controls="farmLandsCollapse">
                                    <i class="bi bi-list-ul me-2"></i>View Farm Land Details ({{ farm_lands|length }} propert{{ farm_lands|length|pluralize:"y,ies" }})
                                </button>
                            </h2>
                            <div id="farmLandsCollapse" class="accordion-collapse collapse" 
                                 aria-labelledby="farmLandsHeading" data-bs-parent="#farmLandsAccordion">
                                <div class="accordion-body">
                                    <div class="row g-3">
                                        {% for farm_land in farm_lands %}
                                            <div class="col-md-6">
                                                <div class="card border-success h-100">
                                                    <div class="card-body">
                                                        <h6 class="card-title text-success">
                                                            <i class="bi bi-house-door me-2"></i>
                                                            {% if farm_land.farmland_name %}
                                                                {{ farm_land.farmland_name }}
                                                            {% else %}
                                                                Farm Land #{{ forloop.counter }}
                                                            {% endif %}
                                                        </h6>
                                                        <ul class="list-group list-group-flush">
                                                            <li class="list-group-item d-flex justify-content-between px-0">
                                                                <span class="fw-medium">Municipality:</span>
                                                                <span>{{ farm_land.municipality.municipality }}</span>
                                                            </li>
                                                            <li class="list-group-item d-flex justify-content-between px-0">
                                                                <span class="fw-medium">Barangay:</span>
                                                                <span>{{ farm_land.barangay.barangay }}</span>
                                                            </li>
                                                            {% if farm_land.estimated_area %}
                                                                <li class="list-group-item d-flex justify-content-between px-0">
                                                                    <span class="fw-medium">Area:</span>
                                                                    <span>{{ farm_land.estimated_area }} hectares</span>
                                                                </li>
                                                            {% endif %}
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <hr>
                <div class="text-center py-3">
                    <i class="bi bi-geo text-muted" style="font-size: 2rem;"></i>
                    <p class="text-muted mt-2 mb-0">No registered farm lands found</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <h3 class="text-success fw-bold mb-3">
        <i class="bi bi-clock-history me-2"></i>Transaction History
    </h3>
    
    <p class="text-muted mb-4">Below is the complete list of transactions submitted by this farmer.</p>
            
            {% if transactions %}
                <!-- Desktop Table View -->
                <div class="d-none d-lg-block">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-success">
                                <tr>
                                    <th><i class="bi bi-calendar3 me-1"></i>Date Created</th>
                                    <th><i class="bi bi-arrow-left-right me-1"></i>Type</th>
                                    <th><i class="bi bi-droplet me-1"></i>Commodity Type</th>
                                    <th><i class="bi bi-geo-alt me-1"></i>Location</th>
                                    <th><i class="bi bi-check-circle me-1"></i>Status</th>
                                    <th><i class="bi bi-eye me-1"></i>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transaction in transactions %}
                                <tr>
                                    <td>
                                        <span class="fw-medium">{{ transaction.transaction_date|date:"M d, Y" }}</span>
                                        <div class="text-muted small">{{ transaction.transaction_date|date:"H:i" }}</div>
                                    </td>
                                    <td>
                                        {% if transaction.initplantrecord %} 
                                            <span class="badge bg-success me-1">
                                                <i class="bi bi-plus-circle me-1"></i>Planting
                                            </span>
                                            {% if transaction.initharvestrecord_set.all %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="bi bi-scissors me-1"></i>Harvest
                                                </span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            <span class="badge bg-warning text-dark">
                                                <i class="bi bi-scissors me-1"></i>Harvest
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary">None</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if transaction.initplantrecord %}
                                            {% if transaction.initplantrecord.commodity_id.pk == 1 %}
                                                <span class="badge bg-warning text-dark">Custom</span>
                                                <div class="small">{{ transaction.initplantrecord.commodity_custom }}</div>
                                            {% elif transaction.initplantrecord.commodity_id.pk > 1 %}
                                                <span class="badge bg-success">{{ transaction.initplantrecord.commodity_id.name }}</span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                {% if first_harvest.commodity_id.pk == 1 %}
                                                    <span class="badge bg-warning text-dark">Custom</span>
                                                    <div class="small">{{ first_harvest.commodity_custom }}</div>
                                                {% elif first_harvest.commodity_id.pk > 1 %}
                                                    <span class="badge bg-success">{{ first_harvest.commodity_id.name }}</span>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if transaction.farm_land %}
                                            <div class="fw-medium">{{ transaction.farm_land.municipality.municipality }}</div>
                                            <div class="text-muted small">{{ transaction.farm_land.barangay.barangay }}</div>
                                        {% elif transaction.manual_municipality %}
                                            <div class="fw-medium">{{ transaction.manual_municipality.municipality }}</div>
                                            {% if transaction.manual_barangay %}
                                                <div class="text-muted small">{{ transaction.manual_barangay.barangay }}</div>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if transaction.initplantrecord %}
                                            {% if transaction.initplantrecord.record_status %}
                                                {% if transaction.initplantrecord.record_status.acc_status == "Verified" %}
                                                    <span class="badge bg-success">
                                                        <i class="bi bi-check-circle me-1"></i>Verified
                                                    </span>
                                                {% elif transaction.initplantrecord.record_status.acc_status == "Pending" %}
                                                    <span class="badge bg-warning text-dark">
                                                        <i class="bi bi-clock me-1"></i>Pending
                                                    </span>
                                                {% elif transaction.initplantrecord.record_status.acc_status == "Rejected" %}
                                                    <span class="badge bg-danger">
                                                        <i class="bi bi-x-circle me-1"></i>Rejected
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ transaction.initplantrecord.record_status.acc_status }}</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge bg-secondary">No Status</span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                {% if first_harvest.record_status %}
                                                    {% if first_harvest.record_status.acc_status == "Verified" %}
                                                        <span class="badge bg-success">
                                                            <i class="bi bi-check-circle me-1"></i>Verified
                                                        </span>
                                                    {% elif first_harvest.record_status.acc_status == "Pending" %}
                                                        <span class="badge bg-warning text-dark">
                                                            <i class="bi bi-clock me-1"></i>Pending
                                                        </span>
                                                    {% elif first_harvest.record_status.acc_status == "Rejected" %}
                                                        <span class="badge bg-danger">
                                                            <i class="bi bi-x-circle me-1"></i>Rejected
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">{{ first_harvest.record_status.acc_status }}</span>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="badge bg-secondary">No Status</span>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            <span class="badge bg-secondary">N/A</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="{% url 'administrator:farmer_transaction_detail' transaction.transaction_id %}" 
                                               class="btn btn-sm btn-outline-primary"
                                               data-bs-toggle="tooltip" title="View Details">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            {% if transaction.initplantrecord and transaction.initplantrecord.record_status.acc_status == "Pending" %}
                                                <a href="{% url 'administrator:admin_verifyplantrec' %}" 
                                                   class="btn btn-sm btn-outline-success"
                                                   data-bs-toggle="tooltip" title="Verify Plant Record">
                                                    <i class="bi bi-check-circle"></i>
                                                </a>
                                            {% endif %}
                                            {% if transaction.initharvestrecord_set.all %}
                                                {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                    {% if first_harvest.record_status.acc_status == "Pending" %}
                                                        <a href="{% url 'administrator:admin_verifyharvestrec' %}" 
                                                           class="btn btn-sm btn-outline-warning"
                                                           data-bs-toggle="tooltip" title="Verify Harvest Record">
                                                            <i class="bi bi-scissors"></i>
                                                        </a>
                                                    {% endif %}
                                                {% endwith %}
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Transactions Pagination for Desktop -->
                    {% if transactions_paginator.num_pages > 1 %}
                    <div class="d-flex justify-content-between align-items-center mt-3 mb-3">
                        <div class="text-muted small">
                            Showing {{ transactions_page_obj.start_index }} to {{ transactions_page_obj.end_index }} of {{ transactions_paginator.count }} transactions
                        </div>
                        <nav aria-label="Transactions Pagination">
                            <ul class="pagination pagination-sm mb-0">
                                {% if transactions_page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page=1">
                                            <i class="bi bi-chevron-double-left"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_page_obj.previous_page_number }}">
                                            <i class="bi bi-chevron-left"></i>
                                        </a>
                                    </li>
                                {% endif %}
                                
                                {% for num in transactions_page_obj.paginator.page_range %}
                                    {% if transactions_page_obj.number == num %}
                                        <li class="page-item active">
                                            <span class="page-link">{{ num }}</span>
                                        </li>
                                    {% elif num > transactions_page_obj.number|add:'-3' and num < transactions_page_obj.number|add:'3' %}
                                        <li class="page-item">
                                            <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ num }}">{{ num }}</a>
                                        </li>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if transactions_page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_page_obj.next_page_number }}">
                                            <i class="bi bi-chevron-right"></i>
                                        </a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_paginator.num_pages }}">
                                            <i class="bi bi-chevron-double-right"></i>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    </div>
                    {% endif %}
                </div>

                <!-- Mobile Card View -->
                <div class="d-lg-none">
                    {% for transaction in transactions %}
                        <div class="card border-start border-success border-3 mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <div>
                                        <h6 class="mb-1 fw-bold text-success">
                                            <i class="bi bi-calendar3 me-1"></i>{{ transaction.transaction_date|date:"M d, Y" }}
                                        </h6>
                                        <small class="text-muted">{{ transaction.transaction_date|date:"H:i" }}</small>
                                    </div>
                                    <div class="text-end">
                                        {% if transaction.initplantrecord %} 
                                            <span class="badge bg-success mb-1">
                                                <i class="bi bi-plus-circle me-1"></i>Planting
                                            </span>
                                            {% if transaction.initharvestrecord_set.all %}
                                                <br><span class="badge bg-warning text-dark">
                                                    <i class="bi bi-scissors me-1"></i>Harvest
                                                </span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            <span class="badge bg-warning text-dark">
                                                <i class="bi bi-scissors me-1"></i>Harvest
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary">None</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <small class="text-muted d-block">Commodity:</small>
                                        {% if transaction.initplantrecord %}
                                            {% if transaction.initplantrecord.commodity_id.pk == 1 %}
                                                <span class="badge bg-warning text-dark">Custom</span>
                                                <div class="small">{{ transaction.initplantrecord.commodity_custom }}</div>
                                            {% elif transaction.initplantrecord.commodity_id.pk > 1 %}
                                                <span class="badge bg-success">{{ transaction.initplantrecord.commodity_id.name }}</span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                {% if first_harvest.commodity_id.pk == 1 %}
                                                    <span class="badge bg-warning text-dark">Custom</span>
                                                    <div class="small">{{ first_harvest.commodity_custom }}</div>
                                                {% elif first_harvest.commodity_id.pk > 1 %}
                                                    <span class="badge bg-success">{{ first_harvest.commodity_id.name }}</span>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            <span class="text-muted">N/A</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-6">
                                        <small class="text-muted d-block">Location:</small>
                                        {% if transaction.farm_land %}
                                            <div class="small fw-medium">{{ transaction.farm_land.municipality.municipality }}</div>
                                            <div class="text-muted small">{{ transaction.farm_land.barangay.barangay }}</div>
                                        {% elif transaction.manual_municipality %}
                                            <div class="small fw-medium">{{ transaction.manual_municipality.municipality }}</div>
                                            {% if transaction.manual_barangay %}
                                                <div class="text-muted small">{{ transaction.manual_barangay.barangay }}</div>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-muted small">N/A</span>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <small class="text-muted d-block">Status:</small>
                                        {% if transaction.initplantrecord %}
                                            {% if transaction.initplantrecord.record_status %}
                                                {% if transaction.initplantrecord.record_status.acc_status == "Verified" %}
                                                    <span class="badge bg-success">
                                                        <i class="bi bi-check-circle me-1"></i>Verified
                                                    </span>
                                                {% elif transaction.initplantrecord.record_status.acc_status == "Pending" %}
                                                    <span class="badge bg-warning text-dark">
                                                        <i class="bi bi-clock me-1"></i>Pending
                                                    </span>
                                                {% elif transaction.initplantrecord.record_status.acc_status == "Rejected" %}
                                                    <span class="badge bg-danger">
                                                        <i class="bi bi-x-circle me-1"></i>Rejected
                                                    </span>
                                                {% else %}
                                                    <span class="badge bg-secondary">{{ transaction.initplantrecord.record_status.acc_status }}</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge bg-secondary">No Status</span>
                                            {% endif %}
                                        {% elif transaction.initharvestrecord_set.all %}
                                            {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                {% if first_harvest.record_status %}
                                                    {% if first_harvest.record_status.acc_status == "Verified" %}
                                                        <span class="badge bg-success">
                                                            <i class="bi bi-check-circle me-1"></i>Verified
                                                        </span>
                                                    {% elif first_harvest.record_status.acc_status == "Pending" %}
                                                        <span class="badge bg-warning text-dark">
                                                            <i class="bi bi-clock me-1"></i>Pending
                                                        </span>
                                                    {% elif first_harvest.record_status.acc_status == "Rejected" %}
                                                        <span class="badge bg-danger">
                                                            <i class="bi bi-x-circle me-1"></i>Rejected
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">{{ first_harvest.record_status.acc_status }}</span>
                                                    {% endif %}
                                                {% else %}
                                                    <span class="badge bg-secondary">No Status</span>
                                                {% endif %}
                                            {% endwith %}
                                        {% else %}
                                            <span class="badge bg-secondary">N/A</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="btn-group" role="group">
                                        <a href="{% url 'administrator:farmer_transaction_detail' transaction.transaction_id %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye me-1"></i>View
                                        </a>
                                        {% if transaction.initplantrecord and transaction.initplantrecord.record_status.acc_status == "Pending" %}
                                            <a href="{% url 'administrator:admin_verifyplantrec' %}" 
                                               class="btn btn-sm btn-outline-success">
                                                <i class="bi bi-check-circle me-1"></i>Verify
                                            </a>
                                        {% endif %}
                                        {% if transaction.initharvestrecord_set.all %}
                                            {% with transaction.initharvestrecord_set.first as first_harvest %}
                                                {% if first_harvest.record_status.acc_status == "Pending" %}
                                                    <a href="{% url 'administrator:admin_verifyharvestrec' %}" 
                                                       class="btn btn-sm btn-outline-warning">
                                                        <i class="bi bi-scissors me-1"></i>Verify
                                                    </a>
                                                {% endif %}
                                            {% endwith %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Transactions Pagination -->
                {% if transactions_paginator.num_pages > 1 %}
                <div class="d-flex justify-content-between align-items-center mt-4 mb-3">
                    <div class="text-muted small">
                        Showing {{ transactions_page_obj.start_index }} to {{ transactions_page_obj.end_index }} of {{ transactions_paginator.count }} transactions
                    </div>
                    <nav aria-label="Transactions Pagination">
                        <ul class="pagination pagination-sm mb-0">
                            {% if transactions_page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page=1">
                                        <i class="bi bi-chevron-double-left"></i>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_page_obj.previous_page_number }}">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>
                            {% endif %}
                            
                            {% for num in transactions_page_obj.paginator.page_range %}
                                {% if transactions_page_obj.number == num %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ num }}</span>
                                    </li>
                                {% elif num > transactions_page_obj.number|add:'-3' and num < transactions_page_obj.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ num }}">{{ num }}</a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {% if transactions_page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_page_obj.next_page_number }}">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                                <li class="page-item">
                                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'trans_page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}trans_page={{ transactions_paginator.num_pages }}">
                                        <i class="bi bi-chevron-double-right"></i>
                                    </a>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
            {% else %}
                <div class="text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-inbox display-1 text-muted"></i>
                    </div>
                    <h5 class="text-muted">No transactions found</h5>
                    <p class="text-muted">This farmer hasn't submitted any transactions yet.</p>
                </div>
            {% endif %}
            
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>

{% endblock content %}