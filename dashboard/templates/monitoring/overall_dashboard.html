{% extends "monitoring/layout.html" %}
{%load static%}

{% block title %}
Fruit Cast | Monitor
{% endblock title %}

{% block navbar %}
    {% include "loggedin/navbar.html" %}
{% endblock navbar %}

{% block content %}
<div class="main-user py-5">
        <div class="row main-user-content justify-content-center">
            <div class="card shadow-sm rounded-4 p-4 mb-4">
                <h1 class="mb-4 text-success fw-bold text-center">
                    <i class="bi bi-bar-chart-line"></i> Monitoring Dashboard
                </h1>
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4" id="monitorTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active link-success" id="harvest-tab" data-bs-toggle="tab" data-bs-target="#harvest" type="button" role="tab" aria-controls="harvest" aria-selected="true">
                            Harvest Data
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link link-success" id="plant-tab" data-bs-toggle="tab" data-bs-target="#plant" type="button" role="tab" aria-controls="plant" aria-selected="false">
                            Plant Data
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="monitorTabsContent">
                    <!-- HARVEST TAB -->
                    <div class="tab-pane fade show active" id="harvest" role="tabpanel" aria-labelledby="harvest-tab">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Total Harvested Weight by Month</h5>
                                    {% if chart_data.monthly_harvest %}
                                        <canvas id="harvestMonthlyChart" height="300"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No monthly harvest data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Total Harvested Weight by Commodity</h5>
                                    {% if chart_data.harvest_commodity %}
                                        <canvas id="harvestWeightChart" height="300"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No commodity harvest data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Total Harvested Weight by Municipality</h5>
                                    {% if chart_data.harvest_municipality %}
                                        <canvas id="harvestLocationChart" height="75"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No harvest location data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- PLANT TAB -->
                    <div class="tab-pane fade" id="plant" role="tabpanel" aria-labelledby="plant-tab">
                        <div class="row g-4">
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Number of Plantings per Commodity</h5>
                                    {% if chart_data.plant_commodity %}
                                        <canvas id="plantCommodityChart" height="200"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No plant commodity data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Estimated Harvest Weight per Commodity</h5>
                                    {% if chart_data.estimated_weight.values %}
                                        <canvas id="plantEstimatedWeightChart" height="200"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No estimated weight data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Average Land Area per Commodity</h5>
                                    {% if chart_data.avg_land_area.values %}
                                        <canvas id="plantLandAreaChart" height="100"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No land area data available.</div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="card shadow-sm rounded-4 p-4 mb-4">
                                    <h5 class="card-title text-center mb-3">Number of Plantings per Municipality</h5>
                                    {% if chart_data.plant_by_location.values %}
                                        <canvas id="plantLocationChart" height="100"></canvas>
                                    {% else %}
                                        <div class="alert alert-info">No location data available.</div>
                                    {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js and Dynamic Data Injection -->
<script>
    // HARVEST CHARTS
    const harvest_months = {{ chart_data.monthly_harvest.labels|safe }};
    const harvest_weights_by_month = {{ chart_data.monthly_harvest.values|safe }};

    const harvest_commodities = {{ chart_data.harvest_commodity.labels|safe }};
    const harvest_weights_by_commodity = {{ chart_data.harvest_commodity.values|safe }};

    const harvest_municipality = {{ chart_data.harvest_municipality.labels|safe }};
    const harvest_weights_by_location = {{ chart_data.harvest_municipality.values|safe }};

    // PLANT CHARTS
    const plant_commodities = {{ chart_data.plant_commodity.labels|safe }};
    const plant_units_by_commodity = {{ chart_data.plant_commodity.values|safe }};
    const plant_estimated_labels = {{ chart_data.estimated_weight.labels|safe }};
    const plant_estimated_values = {{ chart_data.estimated_weight.values|safe }};

    // since walang data neto na collected (but pede iutilize yung sa farmland owned)
    //const plant_land_area_labels = {{ chart_data.avg_land_area.labels|safe }};
    //const plant_land_area_values = {{ chart_data.avg_land_area.values|safe }};

    const plant_location_labels = {{ chart_data.plant_by_location.labels|safe }};
    const plant_location_values = {{ chart_data.plant_by_location.values|safe }};

document.addEventListener('DOMContentLoaded', function() {

    const harvestMonthlyChart = new Chart(document.getElementById('harvestMonthlyChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: harvest_months,
                datasets: [{
                    label: 'Total Harvested Weight (Kg)',
                    data: harvest_weights_by_month,
                    borderColor: 'rgb(75, 192, 192)',
                    fill: false,
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " Kg";
                            }
                        }
                    }
                }
            }
        });

        // HARVEST BY COMMODITY CHART
        const harvestWeightChart = new Chart(document.getElementById('harvestWeightChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: harvest_commodities,
                datasets: [{
                    label: 'Harvested Weight by Commodity (Kg)',
                    data: harvest_weights_by_commodity,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgb(75, 192, 192)',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " Kg";
                            }
                        }
                    }
                }
            }
        });

        // HARVEST BY MUNICIPALITY CHART
        const harvestLocationChart = new Chart(document.getElementById('harvestLocationChart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: harvest_municipality,
                datasets: [{
                    label: 'Harvested Weight by Municipality (Kg)',
                    data: harvest_weights_by_location,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                    borderColor: '#fff',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " Kg";
                            }
                        }
                    }
                }
            }
        });

        // PLANT CHARTS

        // PLANT COMMODITIES CHART
        const plantCommodityChart = new Chart(document.getElementById('plantCommodityChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: plant_commodities,
                datasets: [{
                    label: 'Number of Plantings',
                    data: plant_units_by_commodity,
                    backgroundColor: 'rgba(153, 102, 255, 0.2)',
                    borderColor: 'rgba(153, 102, 255, 1)',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " units";
                            }
                        }
                    }
                }
            }
        });

        // ESTIMATED WEIGHT CHART
        
        const plantEstimatedWeightChart = new Chart(document.getElementById('plantEstimatedWeightChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: plant_estimated_labels,
                datasets: [{
                    label: 'Estimated Weight by Commodity (Kg)',
                    data: plant_estimated_values,
                    backgroundColor: 'rgba(255, 159, 64, 0.2)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " Kg";
                            }
                        }
                    }
                }
            }
        });
        

        // AVERAGE LAND AREA CHART
        /*
        const plantLandAreaChart = new Chart(document.getElementById('plantLandAreaChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: plant_land_area_labels,
                datasets: [{
                    label: 'Average Land Area by Commodity (sq. meters)',
                    data: plant_land_area_values,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " sq. meters";
                            }
                        }
                    }
                }
            }
        });
*/
        // PLANT BY LOCATION CHART
        const plantLocationChart = new Chart(document.getElementById('plantLocationChart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: plant_location_labels,
                datasets: [{
                    label: 'Plantings by Location',
                    data: plant_location_values,
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                    borderColor: '#fff',
                    borderWidth: 1
                }],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function (tooltipItem) {
                                return tooltipItem.raw + " plantings";
                            }
                        }
                    }
                }
            }
        });
});



</script>
{% comment %} <script src="{% static 'js/monitoring.js' %}"></script> {% endcomment %}

{% endblock %}

{% comment %} 
HARVEST
 Monthly Harvest Trend (Line Chart
 Top Harvest Locations (Bar/Horizontal Chart)
 Total Harvest Summary (Cards)

PLANT
 Estimated Future Harvests (Line or Bar Chart)
 Recent Plantings Table
 
FILTER & INTERACTION TOOLS
 Dynamic Filters with AJAX (Optional for Later)

INSIGHTS / ALERTS (Optional, Advanced)
 Low Planting Warning
 Harvest Delay Detection


 THESIS2

 1. For All Users (General Overview)
Total Harvested Weight by Commodity (Bar/Donut Chart)

Shows which crops are most productive overall.
Total Harvested Weight by Municipality (Map or Bar Chart)

Visualizes which areas are producing the most.
Monthly Harvest Trends (Line Chart)

Shows seasonality and trends over time for all commodities or a selected one.
2. For Farmers (Personal/Account-Specific)
My Plantings and Harvests Timeline (Gantt or Calendar View)

Shows when their crops were planted and harvested.
Expected Harvest Dates (Table or Timeline)*

Lists their plantings with expected harvest windows (using years_to_mature and seasonal_months).*
My Best Performing Commodity (Summary Card)

Highlights which crop gave them the most yield.
3. For Administrators/Agriculturists
Top Commodities by Municipality (Heatmap or Table)

Shows which crops are most common/productive in each area.
Harvest Forecast by Municipality and Commodity (Bar/Line Chart)

Uses your forecast model to show expected yields for planning.
Planting Density Map

Number of plantings per barangay/municipality (choropleth map).
Verification Status Overview (Pie/Bar Chart)

Shows how many records are verified, pending, rejected, etc.
Recent Activity Feed

List of latest plantings, harvests, and verifications.
4. Useful Filters for All Dashboards
Filter by Year/Month

See trends or totals for a specific period.
Filter by Commodity

Focus on a specific crop.
Filter by Municipality/Barangay

Focus on a specific area.
5. Advanced/Actionable Insights
Yield per Hectare by Commodity (Bar Chart)

Average yield per unit area, helps identify best practices.
Seasonal Forecast Alerts

Highlight months with expected high/low yields for each commodity.
Low Planting Warning

Alert if a municipality has unusually low planting activity.
Harvest Delay Detection

Flag plantings that are overdue for harvest based on expected maturity.
Example Dashboard Layout
A. Summary Cards
Total Harvested (kg)
Total Plantings
Most Productive Municipality
Most Popular Commodity
B. Charts
Bar: Harvested Weight by Commodity
Line: Monthly Harvest Trend (with year filter)
Pie: Plantings by Municipality
Map: Harvest/Planting Density Map
C. Tables
Expected Harvests (Upcoming)
Recent Plantings/Harvests
D. Filters
Year, Month, Commodity, Municipality


For easier mapping ng plan or explanation idk??
Chart title = 'Harvested Weight by Commodity', 'Harvested Weight by Municipality', 'Monthly Harvest Trend', 'Plantings by Commodity', 'Plantings by Municipality', 'Average Yield per Hectare by Commodity', 'Verification Status Distribution', 'Forecasted Harvest Next Month'
x-axis/labels = 'Commodity Name', 'Municipality Name', 'Month/Year', 'Commodity Name', 'Municipality Name', 'Commodity Name', 'Municipality Name', 'Commodity Name', 'Status', 'Commodity Name'
y-axis/labels = 'Total Weight (kg)', 'Total Weight (kg)', 'Total Weight (kg)', 'Number of Plantings', 'Number of Plantings', 'Yield per Hectare', 'Count', 'Forecasted Weight (kg)'
filters = 'Year, Municipality', 'Year, Commodity', 'Commodity, Municipality', 'Year, Municipality', 'Year, Commodity', 'Year, Municipality', 'Year, Municipality', 'Municipality'

 {% endcomment %}