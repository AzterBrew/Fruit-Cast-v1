{% extends "registration/layout.html" %} 
{% block title %} Fruit Cast | Register {% endblock title %} 


{% block navbar %}
    {% include "registration/navbar.html" %}
{% endblock navbar %}

{%block content %}
{% comment %} <div class="container1 center-div-text">
  <h1>REGISTER</h1>
    <br>
    <form action="" method="POST">
    {% csrf_token %} 
    {% for field in form %}
    <div class="form-group">
      {{ field.label_tag }}
      {{ field }}

      {% if field.errors %}
        <p class="form-error">{{ field.errors|striptags }}</p>
      {% endif %}
    </div>
    <br>
  {% endfor %}
    
    <button type="Submit">Submit</button>
  </form>
  <br>
  <p>or</p>
  <a href="/accounts/login">Log In</a>


</div> {% endcomment %}
<div class="login-container">
  <div class="container py-5" style="max-width: 900px;">
    <div class="card shadow p-4">
      <h1 class="text-center mb-4">Complete Registration</h1>
      <form method="POST" id="register-form" novalidate>
          {% csrf_token %}
          {% for field in form %}
            {% if field.name != 'barangay_id' and  field.name != 'municipality_id'%}
              <div class="mb-3">
                <label class="form-label">{{ field.label_tag }}</label>
                {{ field }}
                {% if field.errors %}
                  <div class="text-danger small">{{ field.errors }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}

          <!-- Municipality -->
          <div class="mb-3">
            <label class="form-label" for="id_municipality_id">Municipality *</label>
            {{ form.municipality_id }}
          </div>

          <!-- Barangay (disabled initially) -->
          <div class="mb-3">
            <label class="form-label" for="id_barangay_id">Barangay *</label>
            <select name="barangay_id" id="id_barangay_id" class="form-select" disabled>
              <option value="">Select a municipality first</option>
            </select>
          </div>
    
          <div class="text-center mt-4">
            <hr />
            <button type="submit" class="btn btn-success">Next Step</button>
            <div class="mt-3">
              <p>or</p>
              <a href="/accounts/login" class="btn btn-secondary">Log In</a>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const municipalitySelect = document.getElementById('id_municipality_id');
  const barangaySelect = document.getElementById('id_barangay_id');

  municipalitySelect.addEventListener('change', function () {
    const municipalityId = this.value;
    barangaySelect.innerHTML = '';
    barangaySelect.disabled = true;

    if (municipalityId) {
      fetch(`/get-barangays/${municipalityId}/`)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            barangaySelect.disabled = false;
            barangaySelect.innerHTML = '<option value="">Select Barangay</option>';
            data.forEach(barangay => {
              const option = document.createElement('option');
              option.value = barangay.id;
              option.textContent = barangay.name;
              barangaySelect.appendChild(option);
            });
          }
        });
    } else {
      barangaySelect.innerHTML = '<option value="">Select a municipality first</option>';
    }
  });
});
</script>




{% endblock content %}
