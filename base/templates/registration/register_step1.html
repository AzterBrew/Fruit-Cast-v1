{% extends "registration/layout.html" %} 
{% block title %} Fruit Cast | Register {% endblock title %} 

{%block content %}
<div class="container-fluid auth-container d-flex justify-content-center align-items-center min-vh-100 py-4">
  <div class="row w-100 justify-content-center">
    <div class="col-12 col-sm-10 col-md-8 col-lg-7 col-xl-6 col-xxl-5">
      <div class="card shadow-lg border-0 rounded-4 auth-card">
        <div class="card-body p-4 p-md-5">
          <!-- Logo/Brand -->
          <div class="text-center mb-4">
            <div class="text-success mb-2">
                <img src="{% static 'images/logo/3.png' %}" alt="Fruit Cast Logo" style="max-height: 10rem;" class="me-2">

            </div>
            <h1 class="h2 text-success fw-bold mb-0">Fruit Cast</h1>
            <p class="text-muted small">Complete your registration</p>
          </div>

          <form method="POST" id="register-form" novalidate>
            {% csrf_token %}
            
            <!-- Personal Information Section -->
            <div class="mb-4 registration-section">
              <h5 class="text-success mb-3">
                <i class="bi bi-person me-2"></i>Personal Information
              </h5>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_firstname">
                    <i class="bi bi-person-badge me-1"></i>First Name *
                  </label>
                  {{ form.firstname }}
                  {% if form.firstname.errors %}
                    <div class="text-danger small mt-1">{{ form.firstname.errors }}</div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_lastname">
                    <i class="bi bi-person-badge me-1"></i>Last Name *
                  </label>
                  {{ form.lastname }}
                  {% if form.lastname.errors %}
                    <div class="text-danger small mt-1">{{ form.lastname.errors }}</div>
                  {% endif %}
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_middlename">
                    <i class="bi bi-person-badge me-1"></i>Middle Name *
                  </label>
                  {{ form.middlename }}
                  {% if form.middlename.errors %}
                    <div class="text-danger small mt-1">{{ form.middlename.errors }}</div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_nameextension">
                    <i class="bi bi-person-badge me-1"></i>Name Extension
                  </label>
                  {{ form.nameextension }}
                  {% if form.nameextension.errors %}
                    <div class="text-danger small mt-1">{{ form.nameextension.errors }}</div>
                  {% endif %}
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_sex">
                    <i class="bi bi-gender-ambiguous me-1"></i>Sex *
                  </label>
                  {{ form.sex }}
                  {% if form.sex.errors %}
                    <div class="text-danger small mt-1">{{ form.sex.errors }}</div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_birthdate">
                    <i class="bi bi-calendar me-1"></i>Date of Birth *
                  </label>
                  {{ form.birthdate }}
                  {% if form.birthdate.errors %}
                    <div class="text-danger small mt-1">{{ form.birthdate.errors }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Contact Information Section -->
            <div class="mb-4 registration-section">
              <h5 class="text-success mb-3">
                <i class="bi bi-telephone me-2"></i>Contact Information
              </h5>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_contact_number">
                    <i class="bi bi-phone me-1"></i>Contact Number *
                  </label>
                  {{ form.contact_number }}
                  {% if form.contact_number.errors %}
                    <div class="text-danger small mt-1">{{ form.contact_number.errors }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Address Information Section -->
            <div class="mb-4 registration-section">
              <h5 class="text-success mb-3">
                <i class="bi bi-geo-alt me-2"></i>Address Information
              </h5>
              
              <div class="mb-3">
                <label class="form-label" for="id_address_details">
                  <i class="bi bi-house me-1"></i>Address Details *
                </label>
                {{ form.address_details }}
                {% if form.address_details.errors %}
                  <div class="text-danger small mt-1">{{ form.address_details.errors }}</div>
                {% endif %}
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_municipality_id">
                    <i class="bi bi-building me-1"></i>Municipality *
                  </label>
                  {{ form.municipality_id }}
                  {% if form.municipality_id.errors %}
                    <div class="text-danger small mt-1">{{ form.municipality_id.errors }}</div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_barangay_id">
                    <i class="bi bi-signpost me-1"></i>Barangay *
                  </label>
                  <select name="barangay_id" id="id_barangay_id" class="form-select" disabled>
                    <option value="">Select a municipality first</option>
                  </select>
                  {% if form.barangay_id.errors %}
                    <div class="text-danger small mt-1">{{ form.barangay_id.errors }}</div>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Additional Information Section -->
            <div class="mb-4 registration-section">
              <h5 class="text-success mb-3">
                <i class="bi bi-info-circle me-2"></i>Additional Information
              </h5>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_religion">
                    <i class="bi bi-heart me-1"></i>Religion *
                  </label>
                  {{ form.religion }}
                  {% if form.religion.errors %}
                    <div class="text-danger small mt-1">{{ form.religion.errors }}</div>
                  {% endif %}
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_civil_status">
                    <i class="bi bi-people me-1"></i>Civil Status *
                  </label>
                  {{ form.civil_status }}
                  {% if form.civil_status.errors %}
                    <div class="text-danger small mt-1">{{ form.civil_status.errors }}</div>
                  {% endif %}
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label" for="id_rsbsa_ref_number">
                    <i class="bi bi-file-text me-1"></i>RSBSA Reference Number
                  </label>
                  {{ form.rsbsa_ref_number }}
                  <small class="form-text text-muted">Optional - for registered farmers</small>
                </div>
              </div>
            </div>

            <div class="d-grid gap-2 mt-4">
              <button type="submit" class="btn btn-success btn-lg">
                <i class="bi bi-check-circle me-2"></i>Complete Registration
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  // Municipality and Barangay handling
  const municipalitySelect = document.getElementById('id_municipality_id');
  const barangaySelect = document.getElementById('id_barangay_id');

  municipalitySelect.addEventListener('change', function () {
    const municipalityId = this.value;
    barangaySelect.innerHTML = '';
    barangaySelect.disabled = true;

    if (municipalityId) {
      fetch(`/get-barangays/${municipalityId}/`)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            barangaySelect.disabled = false;
            barangaySelect.innerHTML = '<option value="">Select a barangay</option>';
            data.forEach(barangay => {
              const option = document.createElement('option');
              option.value = barangay.id;
              option.textContent = barangay.name;
              barangaySelect.appendChild(option);
            });
          } else {
            barangaySelect.innerHTML = '<option value="">No barangays available</option>';
          }
        })
        .catch(error => {
          console.error('Error fetching barangays:', error);
          barangaySelect.innerHTML = '<option value="">Error loading barangays</option>';
        });
    } else {
      barangaySelect.innerHTML = '<option value="">Select a municipality first</option>';
    }
  });

  // Simple year validation for birthdate
  const birthdateInput = document.getElementById('id_birthdate');
  if (birthdateInput) {
    birthdateInput.addEventListener('input', function() {
      const value = this.value;
      if (value) {
        const dateParts = value.split('-');
        // Limit year to 4 digits
        if (dateParts[0] && dateParts[0].length > 4) {
          dateParts[0] = dateParts[0].substring(0, 4);
          this.value = dateParts.join('-');
        }
      }
    });
  }
});
</script>

{% endblock content %}